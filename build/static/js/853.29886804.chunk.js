"use strict";(self.webpackChunksafeline_IOT=self.webpackChunksafeline_IOT||[]).push([[853],{73853:function(e,n,t){t.r(n),t.d(n,{default:function(){return C}});var a=t(29439),i=t(78983),s=t(72791),o=t(93001),r=t(52036),c=t(18043),d=t(91933),l=t(99579),u=t(57689),m=t(77868),h=t(18393),v=t(4942),f=t(1413),p=t(24846),g=t(51843),x=t(99412),b=t(31397),j=t(66757),k=t(10781),S=t(80184),y=function(e){var n,t=e.closeModal,o=e.saveHandler,r=e.data,d=JSON.parse(localStorage.getItem("permissions")),u=(0,j.Z_)(d,j.BA,j.H2),m=(0,c.U)().dispatch,h=(0,k.Z)((function(e){return e.data})),y=(0,s.useState)(!1),A=(0,a.Z)(y,2),F=A[0],E=A[1],Z=(0,s.useState)({firstname:"",lastname:"",email:"",address:"",phonenumber:"",customerid:"",isSuperAdmin:!1}),U=(0,a.Z)(Z,2),N=U[0],C=U[1];(0,s.useEffect)((function(){r&&C((function(){return{customerid:r.customerid,firstname:r.firstname,lastname:r.lastname,email:r.email,address:r.address,phonenumber:r.phonenumber}}))}),[r]);var M=function(e){var n=e.target,t=n.name,a=n.value,i=n.type,s=n.checked,o=a;"customerid"===t&&(o=parseInt(a,10)||0),C((0,f.Z)((0,f.Z)({},N),{},(0,v.Z)({},t,"checkbox"===i?s:o)))},w=(0,l.X)(),I=w.darkMode;w.setDarkMode;return(0,s.useEffect)((function(){}),[I]),(0,S.jsxs)(i.lx,{className:"row mt-2 g-3 needs-validation",noValidate:!0,validated:F,onSubmit:function(e){var n=e.currentTarget;e.preventDefault(),!1===n.checkValidity()&&e.stopPropagation(),E(!0),!0===n.checkValidity()&&(m({type:"SHOW_LOADER"}),o(N),console.log(N),t())},children:[u&&(0,S.jsxs)(i.b7,{md:12,children:[(0,S.jsx)(i.L8,{id:"".concat(I?"heading-dark":""),htmlFor:"validationFacilityName",children:"Organization"}),(0,S.jsxs)(i.LX,{name:"customerid",className:" form-select ".concat(I?"select-dark":""),"aria-describedby":"validationCustom04Feedback",feedbackInvalid:"Please select a valid Organization.",value:N.customerid,onChange:M,required:!0,disabled:!!r,children:[(0,S.jsx)("option",{children:"Select Organization"}),null===(n=h[0])||void 0===n?void 0:n.map((function(e){return(0,S.jsx)("option",{value:e.customerid,children:e.customername},e.customerid)}))]})]}),(0,S.jsxs)(i.b7,{md:6,children:[(0,S.jsx)(i.L8,{id:"".concat(I?"heading-dark":""),htmlFor:"validationFirstname",children:"First Name"}),(0,S.jsxs)(i.YR,{children:[(0,S.jsx)(i.wV,{}),(0,S.jsx)(i.jO,{type:"text",className:"input-light pt-0 ".concat(I?"input-dark":""),name:"firstname",value:N.firstname,onChange:M,feedbackInvalid:"First Name is required",id:"validationCustom01",required:!0})]})]}),(0,S.jsxs)(i.b7,{md:6,children:[(0,S.jsx)(i.L8,{id:"".concat(I?"heading-dark":""),htmlFor:"validationLastname",children:"Last Name"}),(0,S.jsxs)(i.YR,{className:"has-validation",children:[(0,S.jsx)(i.wV,{}),(0,S.jsx)(i.jO,{type:"text",className:"input-light pt-0 ".concat(I?"input-dark":""),name:"lastname",value:N.lastname,onChange:M,feedbackInvalid:"Last name is required",id:"validationCustom02",required:!0})]})]}),(0,S.jsxs)(i.b7,{md:12,children:[(0,S.jsx)(i.L8,{id:"".concat(I?"heading-dark":""),htmlFor:"validationEmail",children:"Email"}),(0,S.jsxs)(i.YR,{className:"has-validation",children:[(0,S.jsx)(i.wV,{children:(0,S.jsx)(p.Z,{icon:g.p,alt:"Email"})}),(0,S.jsx)(i.jO,{type:"email",className:"input-light pt-0 ".concat(I?"input-dark":""),name:"email",value:N.email,onChange:function(e){var n=e.target,t=n.name,a=n.value,i=n.type,s=n.checked;C((0,f.Z)((0,f.Z)({},N),{},(0,v.Z)({},t,"checkbox"===i?s:a)));var o=e.target.value,r=/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(o);E(r)},"aria-describedby":"inputGroupPrependFeedback",feedbackInvalid:" Email is required",id:"validationEmail",required:!0})]})]}),(0,S.jsxs)(i.b7,{md:12,children:[(0,S.jsx)(i.L8,{id:"".concat(I?"heading-dark":""),htmlFor:"validationCustomAddress",children:"Address"}),(0,S.jsxs)(i.YR,{children:[(0,S.jsx)(i.wV,{children:(0,S.jsx)(p.Z,{icon:x.i,alt:"Address"})}),(0,S.jsx)(i.jO,{className:"input-light pt-0 ".concat(I?"input-dark":""),type:"text",name:"address",value:N.address,onChange:M,"aria-describedby":"validationCustom03Feedback",feedbackInvalid:"Address is required.",id:"validationCustom03",required:!0})]})]}),(0,S.jsxs)(i.b7,{md:12,children:[(0,S.jsx)(i.L8,{id:"".concat(I?"heading-dark":""),htmlFor:"validationCustomPhonenumber",children:"Phone Number"}),(0,S.jsxs)(i.YR,{children:[(0,S.jsx)(i.wV,{children:(0,S.jsx)(p.Z,{icon:b.d,alt:"Phonenumber"})}),(0,S.jsx)(i.jO,{className:"input-light pt-0 ".concat(I?"input-dark":""),type:"text",name:"phonenumber",value:N.phonenumber,onChange:M,"aria-describedby":"validationCustom05Feedback",feedbackInvalid:"Phone Number is required",id:"validationCustom05",required:!0})]})]}),(0,S.jsx)(i.b7,{xs:12,children:(0,S.jsx)(i.u5,{color:"primary",className:"float-end",id:"".concat(I?"button-dark":""),type:"submit",children:r?"Edit User ":"Add User "})})]})},A=t(17834),F=t(46522),E=t(96062),Z=t(45013),U=function(e){var n,t,o,r=e.closeModal,u=e.assignHandler,m=e.data,h=e.selectedRole,p=e.UnAssignHandler,g=JSON.parse(localStorage.getItem("permissions")),x=(0,s.useState)(!1),b=(0,a.Z)(x,2),k=b[0],y=b[1],U=(0,s.useState)(),N=(0,a.Z)(U,2),C=N[0],M=N[1],w=(0,s.useState)(),I=(0,a.Z)(w,2),O=I[0],D=I[1],L=(0,s.useState)(),_=(0,a.Z)(L,2),H=_[0],R=_[1],V=(0,s.useState)(!1),X=(0,a.Z)(V,2),q=X[0],P=X[1],z=(0,c.U)().dispatch,T=(0,d.useMutation)(Z.WH).mutate,Y=(0,d.useMutation)(F.pF).mutate,J=((0,j.Z_)(g,j.BA,j.H2),(0,j.Z_)(g,j.vw,j.H2),(0,j.Z_)(g,j.JK,j.H2),(0,s.useState)({userid:m.userid,is_admin:q})),W=(0,a.Z)(J,2),$=W[0],B=W[1];(0,d.useMutation)(A.iU).mutate;(0,d.useMutation)(A.XH).mutate;var G=function(e){console.log(e.target.value);var n=e.target,t=n.name,a=n.value,i=n.type,s=n.checked;console.log(e.target.value);var o="deviceid"!==t&&"facilityid"!==t&&"departmentid"!==t||a==="Selected ".concat(t.charAt(0).toUpperCase()+t.slice(1))?a:parseInt(a,10);B((0,f.Z)((0,f.Z)({},$),{},(0,v.Z)({},t,"checkbox"===i?s:o)))};var K=(0,d.useMutation)(E.Xo).mutate;var Q=(0,l.X)(),ee=Q.darkMode;Q.setDarkMode;return(0,s.useEffect)((function(){T("",{onSuccess:function(e){M(e)},onError:function(e){}}),Y("",{onSuccess:function(e){D(e)},onError:function(e){}}),K("",{onSuccess:function(e){R(e)},onError:function(e){}})}),[]),(0,S.jsx)(i.lx,{className:"row mt-2 g-3 needs-validation",noValidate:!0,validated:k,onSubmit:function(e){e.preventDefault();var n=e.currentTarget;!1===n.checkValidity()&&e.stopPropagation(),y(!0),B((0,f.Z)((0,f.Z)({},$),{},{is_admin:q})),!0===n.checkValidity()&&(console.log($),z({type:"SHOW_LOADER"}),u($),r())},children:"Assigned"===h?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("h4",{className:"ms-3 pt-2",id:"".concat(ee?"heading-dark":""),children:["Are you sure you want to UnAssign this User ?"," "]}),(0,S.jsx)(i.b7,{xs:11,className:"modal-light ".concat(ee?"modal-dark":""),children:(0,S.jsx)(i.u5,{color:"danger",className:"float-end ms-2",onClick:function(){p(m)},children:"UnAssign"})})]}):(0,S.jsxs)(S.Fragment,{children:[" ",(0,S.jsxs)(i.b7,{md:12,children:[(0,S.jsx)(i.L8,{id:"".concat(ee?"heading-dark":""),htmlFor:"validationManufacturerName",children:"Facility*"}),(0,S.jsxs)(i.LX,{name:"facilityid","aria-describedby":"validationCustom04Feedback",feedbackInvalid:"Please select a valid facility.",id:"validationFacilities",className:" form-select ".concat(ee?"select-dark":""),value:$.facilityid,onChange:G,disabled:$.departmentid||$.deviceid,children:[(0,S.jsx)("option",{children:"Facilities"}),null===C||void 0===C||null===(n=C.data)||void 0===n?void 0:n.map((function(e){return(0,S.jsx)("option",{value:e.facilityid,children:e.name},e.facilityid)}))]})]}),(0,S.jsxs)(i.b7,{md:12,children:[(0,S.jsx)(i.L8,{id:"".concat(ee?"heading-dark":""),htmlFor:"validationManufacturerName",children:"Department Selection*"}),(0,S.jsxs)(i.LX,{name:"departmentid","aria-describedby":"validationCustom04Feedback",feedbackInvalid:"Please select a valid facility.",id:"validationDepartment",value:$.departmentid,onChange:G,className:" form-select ".concat(ee?"select-dark":""),disabled:$.facilityid||$.deviceid,children:[(0,S.jsx)("option",{children:"Departments"}),null===O||void 0===O||null===(t=O.data)||void 0===t?void 0:t.map((function(e){return(0,S.jsx)("option",{value:e.departmentid,children:e.departmentname},e.departmentid)}))]})]}),(0,S.jsxs)(i.b7,{md:12,children:[(0,S.jsx)(i.L8,{id:"".concat(ee?"heading-dark":""),htmlFor:"validationFacilityName",children:"Devices"}),(0,S.jsxs)(i.LX,{name:"deviceid",className:" form-select ".concat(ee?"select-dark":""),"aria-describedby":"validationCustom04Feedback",feedbackInvalid:"Please select a valid Device.",value:$.deviceid,onChange:G,disabled:$.facilityid||$.departmentid,children:[(0,S.jsx)("option",{children:"Devices"}),null===H||void 0===H||null===(o=H.data)||void 0===o?void 0:o.map((function(e){return(0,S.jsx)("option",{value:e.deviceid,children:e.devicename},e.deviceid)}))]})]}),(0,S.jsx)(i.b7,{xs:12,children:(0,S.jsxs)("div",{className:"form-check",children:[(0,S.jsx)("input",{type:"checkbox",className:"form-check-input",id:"isAdminCheckbox",checked:q,onChange:function(e){P(e.target.checked)},style:{width:"20px",height:"20px"}}),(0,S.jsx)("label",{className:"form-check-label",htmlFor:"isAdminCheckbox",children:"Admin"})]})}),(0,S.jsx)(i.b7,{xs:12,children:(0,S.jsx)(i.u5,{color:"primary",type:"submit",children:"Assign"})})]})})},N=[{key:"rolename",label:"Role"},{key:"name",label:"Assigned To"},{key:"firstname",label:"Name"},{key:"email",label:"Email"},{key:"phonenumber",label:"Contact Number"},{key:"address",label:"Address"}],C=function(){var e=(0,c.U)().dispatch,n=function(){return e({type:"SHOW_LOADER"})},t=function(){return e({type:"HIDE_LOADER"})},v=(0,d.useMutation)(h.cn).mutate,f=(0,d.useMutation)(h.Xk).mutate,p=(0,s.useState)([]),g=(0,a.Z)(p,2),x=g[0],b=g[1],j=(0,s.useState)("UnAssigned"),k=(0,a.Z)(j,2),A=k[0],F=k[1],E=(0,d.useMutation)(h.Z$).mutate,Z=(0,d.useMutation)(h.M6).mutate,C=(0,d.useMutation)(h.vx).mutate,M=(0,d.useMutation)(h.jm).mutate,w=(0,d.useMutation)(h.Lg).mutate,I=(0,d.useMutation)(h.Rp).mutate,O=(0,d.useMutation)(h.dk).mutate,D=(0,d.useMutation)(h.XZ).mutate,L=(0,d.useMutation)(h.lI).mutate,_=(0,d.useMutation)(h.Jd).mutate,H=(0,s.useState)(!1),R=(0,a.Z)(H,2),V=R[0],X=R[1],q=(0,s.useState)(),P=(0,a.Z)(q,2),z=P[0],T=P[1],Y=(0,s.useState)(!1),J=(0,a.Z)(Y,2),W=J[0],$=J[1],B=(0,l.X)().setShowToast,G=(0,d.useMutation)(h.Vt),K=(0,s.useState)(!0),Q=(0,a.Z)(K,2),ee=Q[0],ne=(Q[1],(0,s.useState)(!1)),te=(0,a.Z)(ne,2),ae=te[0],ie=te[1],se=(0,u.s0)(),oe=function(){X(!1)},re=function(){ie(!1)},ce=(0,s.useState)([]),de=(0,a.Z)(ce,2),le=de[0],ue=de[1];function me(){E("",{onSuccess:function(e){b(e.data),t()},onError:function(e){}})}function he(e){Z(e,{onSuccess:function(e){b(e.data),t()},onError:function(e){}})}function ve(e){n(),setTimeout((function(){W?v(e,{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User Created Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}}):f({handler:e,editData:z},{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User Edited Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}})}),0)}(0,s.useEffect)((function(){var e=localStorage.getItem("OrganizationId");e?he(e):me()}),[]);var fe=function(e){var n=localStorage.getItem("OrganizationId");switch(e){case"Assigned":n?(F("Assigned"),function(e){M(e,{onSuccess:function(e){b(e.data),t()},onError:function(e){}})}(n)):(F("Assigned"),C("",{onSuccess:function(e){b(e.data),t()},onError:function(e){}}));break;case"UnAssigned":n?(F("UnAssigned"),he(n)):(F("UnAssigned"),me())}},pe=(0,l.X)(),ge=pe.darkMode;pe.setDarkMode;return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(r.$,{title:W?"Add User":"Edit User",content:W?(0,S.jsx)(y,{closeModal:oe,saveHandler:ve}):(0,S.jsx)(y,{closeModal:oe,saveHandler:ve,data:z}),isOpen:V,onClose:oe}),(0,S.jsx)(r.$,{title:"Assigned"===A?"UnAssign User":"Assign User",content:(0,S.jsx)(U,{closeModal:oe,assignHandler:function(e){t(),e.facilityid?w(e,{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User Assigned to Facility Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}}):e.departmentid?I(e,{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User Assigned to Department Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}}):e.deviceid&&O(e,{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User Assigned to Device Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}}),re()},data:le,selectedRole:A,UnAssignHandler:function(e){var n=e.facilityid,a=e.departmentid,i=e.deviceid;n?D(e,{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User UnAssigned From Facility Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}}):a?L(e,{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User UnAssigned From Department Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}}):i&&_(e,{onSuccess:function(){t(),B((function(){return{show:!0,title:"Success",content:"User UnAssigned From Device Successfully"}})),me()},onError:function(e){t(),B((function(){var n,t;return{show:!0,title:"Error",content:null===e||void 0===e||null===(n=e.response)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.error,color:"#FF0000"}}))}}),re()}}),isOpen:ae,onClose:re}),(0,S.jsxs)(i.xH,{className:"table_container_light p-4 ".concat(ge?"table_container_dark":""),children:[(0,S.jsxs)(i.rb,{children:[(0,S.jsx)(i.b7,{children:(0,S.jsx)("h3",{className:"pb-2",id:"".concat(ge?"heading-dark":""),children:"Users"})}),(0,S.jsx)(i.b7,{md:3,className:"float-end",children:(0,S.jsxs)("select",{size:"sm",className:" form-select ".concat(ge?"select-dark":""),"aria-label":"Department",defaultValue:"Admins",onChange:function(e){return fe(e.target.value)},children:[(0,S.jsx)("option",{value:"UnAssigned",children:"UnAssigned"}),(0,S.jsx)("option",{value:"Assigned",children:"Assigned"})]})}),(0,S.jsx)(i.b7,{children:(0,S.jsx)(i.u5,{color:"primary",className:"float-end",onClick:function(){$(!0),T(null),X(!0)},children:"Add Users"})})]}),x?(0,S.jsx)(m.Z,{columns:N.filter((function(e){return!("unassigned"===A.toLowerCase()&&("rolename"===e.key||"name"===e.key))})).map((function(e){return e})),OnDeleteItem:function(e){n(),G.mutate(e.userid,{onSuccess:function(){B((function(){return{show:!0,title:"Success",content:"User deleted Successfully"}})),me(),t()},onError:function(e){"ERR_BAD_REQUEST"===e.code&&(localStorage.removeItem("token"),localStorage.removeItem("OrganizationId"),localStorage.removeItem("facilityId"),localStorage.removeItem("departmentId"),se("/login")),B((function(){return{show:!0,title:"Error",content:e.response.data.error}})),t()}}),t()},selectedRole:A,data:x,openEditModal:function(e){$(!1),T(e),X(!0)},delUserId:ee,openAssignModal:function(e){ue(e),ie(!0)}}):(0,S.jsx)(o.Z,{})]})]})}}}]);
//# sourceMappingURL=853.29886804.chunk.js.map